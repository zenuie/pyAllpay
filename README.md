Introduction
==
![](https://img.shields.io/badge/python-3.9-green.svg) ![](https://img.shields.io/badge/django-4.0.3-blue.svg)  
This is an unofficial OPay(歐付寶) SDK implemented in Python. not O functions are implemented now.
CheckOutString(), CheckOut(), CheckOutFeedback() has been implemented.
In general, it could be used in web developed by Django ..etc  
**[!!NOTE!!] OPay may updates their SDK constantly, if `pyOpay` doesn't work. Please file a issue.**

### For Python 3, please refer to the [py3Opay](https://github.com/m85091081/py3Opay) by @ m85091081.

Features:
==
Checkout a payment in ...

- [x] CVS
- [x] ATM
- [x] WebATM
- [x] BarCode
- [x] Credit card

Dealing with the POST data returned by 歐付寶(OPay) after the a payment creates or the customer pay the payment.

How to Use:
==
You can clone this project and put the Opay folder under root directory of your project.

    git clone https://github.com/zenuie/pyOpay.git

Then include pyOpay into your project if you directly cloned the source code.
```python
# OPay setting.
from .Opay import Opay
from .models import OpayOrder
```
First, you are required to set your own merchant ID, HashIV, HashKey provided by the 歐付寶 in the setting.py

## Set up in /your-admin/ in Django

Pleae check out OPayReadme in django/opay file documents for more details to know what those variable means :) or
https://www.opay.tw/Content/files/O_Pay_011.pdf

## Initialize an OPay payment

Take Django as instance.([A Django example](https://github.com/lockys/OPay.py/tree/master/demo_django_app)
)
In your Django view.
```python
        op = Opay({'TotalAmount': amount,
                   'ItemName': '破破的贊助費',
                   'TradeDesc': '給予實況主暖心照顧',
                   })
        dict_url = op.check_out()
        create_order = OpayOrder.objects.create(
            Sponsor=sponsor,
            Message=message,
            MerchantTradeNo=dict_url['MerchantTradeNo'],
            MerchantTradeDate=dict_url['MerchantTradeDate'],
            TotalAmount=dict_url['TotalAmount'],
            TradeDesc=dict_url['TradeDesc'],
            ItemName=dict_url['ItemName'],
            CheckMacValue=dict_url['CheckMacValue'])
        create_order.save()
```
#### How to specify `payment_info` dictionary
```python
payment_info = {'TotalAmount': 10, 'ChoosePayment': 'ATM', 'MerchantTradeNo': 'xvd123test', 'ItemName': "test"}
```
- TotalAmount, 交易金額(Number): 10 (NTD)
- ChoosePayment, 付款方式(String): 'ATM', 'WebATM', 'CVS', 'BARCODE', 'Credit'
- MerchantTradeNo, 交易序號(String): 'serial_number' # should be generated by yourself.
- ItemName, 商品名稱(String): 'My Product'  

**Other parameters:**
- TradeDesc, 交易描述(String): 'My Product'
- ItemURL(String)
- Remark(String)
- ChooseSubPayment(String)

You can find what each parameter means at:
[OPay Doc](https://www.opay.tw/Content/files/O_Pay_011.pdf)



## Retrive the POST data from OPay(歐付寶)
```python
# OPay setting.
from .Opay import Opay
from .models import OpayOrder
returns = Opay.checkout_feedback(request.POST) #Django for ex.
```
**returns** will be a dict. that contains the information returned from OPay(歐付寶)
For example, **returns['RtnCode']** indicates the current status of a payment.
Check out the [OPay Documentation](https://www.Opay.com.tw/Service/API_Help?Anchor=AnchorDoc) for more details.

Available payment.
==
CVS, Barcode, ATM, WebATM, Credit card, Client Select
You could simulate to pay in the administator panel provided by OPay, but you should implement the view by your own in order to catch the feedback data from OPay.

Goal:
==
This final goal for this project is to implement the full functionalities of Opay SDK in Python language.

Project Current Status:
==
This project is still a baby. Therefore, the bugs may exist. :smiley:  
I'll try hard to implement all th methods of OPay SDK.  
**Feel free to open issues and pull request to help this project better**

Environment
==
It has been tested with Django 4 and python 3, and works okay for now.

LICENCE
==
MIT
